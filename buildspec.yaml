version: 0.2

env:
  secrets-manager:
    url: "$appname:url"
    dbname: "$appname:dbname"
    name: "$appname:username"
    pass: "$appname:password"
    port: "$appname:port"


phases:

  install:
    commands:
      - ls
      - cd ./wordpress-beanstalk/.ebextensions
      - 'echo "    RDS_HOSTNAME: $url" >> wordpress.config'
      - 'echo "    RDS_DB_NAME: $dbname" >> wordpress.config'
      - 'echo "    RDS_USERNAME: $name" >> wordpress.config'
      - 'echo "    RDS_PASSWORD: $pass" >> wordpress.config'
      - 'echo "    RDS_PORT: $port" >> wordpress.config'
      - cat wordpress.config
      - cd ..
      - zip ../wordpress-beanstalk.zip -r * .[^.]*
      - ls
  # pre_build:
    # commands:
      # - terraform init

  # build:
    # commands:
      # - terraform destroy -var-file=demo.json -auto-approve

  # post_build:
   # commands:
      # - echo terraform apply completed on `date`
artifacts:
  files:
    - ./wordpress-beanstalk.zip